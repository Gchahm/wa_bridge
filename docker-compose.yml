services:
  n8n:
    image: n8nio/n8n
    restart: unless-stopped
    ports:
      - "5678:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=true
      - N8N_BASIC_AUTH_USER=${N8N_USER:-admin}
      - N8N_BASIC_AUTH_PASSWORD=${N8N_PASSWORD:-admin}
      - WEBHOOK_URL=http://n8n:5678
    volumes:
      - n8n-data:/home/node/.n8n
    depends_on:
      - whatsapp

  whatsapp:
    build: ./whatsapp-api
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      - WEBHOOK_URL=${WHATSAPP_WEBHOOK_URL:-http://n8n:5678/webhook/whatsapp}
      - LISTEN_ADDR=:8080
      - DATA_DIR=/data
    volumes:
      - whatsapp-data:/data
    tty: true
    stdin_open: true

volumes:
  n8n-data:
  whatsapp-data:
